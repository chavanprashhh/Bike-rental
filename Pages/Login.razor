@page "/login"
@using System.Text.RegularExpressions
@using Bike_Service_IMS.Data;
@using System.Reflection;
@inject NavigationManager NavManager


<MudCard>
    <MudCardContent>
        <MudText Typo="Typo.h5" Align="Align.Center" Class="fw-bold">Admin Login Details</MudText>
        <MudText Typo="Typo.h6" Align="Align.Center">Username: @UserServices.SeedUsername</MudText>
        <MudText Typo="Typo.h6" Align="Align.Center">Password: @UserServices.SeedPassword</MudText>
    </MudCardContent>
</MudCard>

<MudPaper Height="100%" Width="100%">
    
        <MudPaper Height="100%" Width="100%" Square="false" >
            <MudItem xs="13" sm="6" Class="mx-auto pa-6">
                <MudCard class="mt-4">
                    <MudCardContent>
                        <MudText><h1>Login</h1></MudText>

                        <MudForm>
                            <MudTextField Label="Username" @bind-Value="Username" />
                            <MudTextField Label="Password" @bind-Value="Password" InputType="InputType.Password"/>
                            @if (showError == true)
                            {
                                <MudAlert Severity="Severity.Error">@loginErrorMessage</MudAlert>
                            }
                            <MudButton OnClick="LoginUser" Variant="Variant.Filled" Color="Color.Primary" class="mt-3 justify-content-center">LOGIN</MudButton>
                        </MudForm>

                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudPaper>

</MudPaper>

@code {
    bool showError = false;
    private string loginErrorMessage = "";
    private string Username { get; set; }
    private string Password { get; set; }
    private List<User> users { get; set; }
    [CascadingParameter]
    UserState userState { get; set; }
    protected override void OnInitialized()
    {
        users = UserServices.Read();
    }

    public void LoginUser()
    {
        try
        {
            userState.CurrentUser = UserServices.Login(Username, Password);
            NavManager.NavigateTo("/home");

        }
        catch (Exception e)
        {
            showError=true;
            loginErrorMessage = e.Message;
        }
    }
}
